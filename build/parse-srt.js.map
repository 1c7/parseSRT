{"version":3,"file":null,"sources":["../src/parse-srt.js"],"sourcesContent":["'use strict'\n\n/**\n * @name parseSRT\n * @desc Parses and converts SRT subtitle data into JSON format. Adapted from the popcorn.js SRT parser plugin.\n * @see http://popcornjs.org/\n * @author Luis Rodrigues (http://www.luisrodriguesweb.com)\n * @version 0.1.0-alpha\n * @license MIT\n */\n\n/**\n * @typedef {JSONSubtitle}\n * @property {Number} id - The subtitle ID number.\n * @property {Number} start - The start timestamp in milliseconds.\n * @property {Number} end - The end timestamp in milliseconds.\n * @property {String} text - The subtitle HTML.\n */\n\n/**\n * Convert a HH:MM:SS,MMM or HH:MM:SS.MMM time format into milliseconds.\n *\n * @private\n * @param {String} time - The time to be converted.\n * @return {Number} - The time converted to milliseconds.\n */\nfunction toMilliseconds (time) {\n  const t = time.split(':')\n\n  try {\n    let s = t[2].split(',')\n\n    // Just in case a . is decimal seperator\n    if (s.length === 1) {\n      s = t[2].split('.')\n    }\n\n    return parseFloat(t[0], 10) * 3600000 + parseFloat(t[1], 10) * 60000 + parseFloat(s[0], 10) * 1000 + parseFloat(s[1], 10)\n  } catch (e) {\n    return 0\n  }\n}\n\n/**\n * Get the next non empty line number.\n *\n * @private\n * @param {Array<String>} linesArray - All the lines.\n * @param {Number} position - The current line number.\n * @return {Number} - The number of the next non empty line.\n */\nfunction nextNonEmptyLine (linesArray, position) {\n  let idx = position\n\n  while (!linesArray[idx]) {\n    idx++\n  }\n\n  return idx\n}\n\n/**\n * Get the last non empty line number.\n *\n * @private\n * @param  {Array<String>} linesArray - All the lines.\n * @return {Number} - The number of the last non empty line.\n */\nfunction lastNonEmptyLine (linesArray) {\n  let idx = linesArray.length - 1\n\n  while (idx >= 0 && !linesArray[idx]) {\n    idx--\n  }\n\n  return idx\n}\n\n/**\n * Parses and converts SRT subtitle data into JSON format.\n *\n * @public\n * @param {String} data - The SRT file contents.\n * @return {Array<JSONSubtitle>} - The subtitles in a JSON format.\n *\n * @example\n * var data = `1\n * 00:00:25,712 --> 00:00:30.399\n * This text is <font color=\"red\">RED</font> and has not been {\\pos(142,120)} positioned.\n * This takes \\Nup three \\nentire lines.\n * This contains nested <b>bold, <i>italic, <u>underline</u> and <s>strike-through</s></u></i></b> HTML tags\n * Unclosed but <b>supported tags are left in\n * <ggg>Unsupported</ggg> HTML tags are left in, even if <hhh>not closed.\n * SSA tags with {\\i1} would open and close italicize {\\i0}, but are stripped\n * Multiple {\\pos(142,120)\\b1}SSA tags are stripped`\n *\n * var subtitles = parseSRT(data)\n */\nexport default function parseSRT (data = '') {\n  // declare needed variables and constants\n  const subs = []\n  const lines = data.split(/(?:\\r\\n|\\r|\\n)/gm)\n  let endIdx = lastNonEmptyLine(lines) + 1\n  let idx = 0\n  let time\n  let text\n  let sub\n\n  for (let i = 0; i < endIdx; i++) {\n    sub = {}\n    text = []\n\n    i = nextNonEmptyLine(lines, i)\n    sub.id = parseInt(lines[i++], 10)\n\n    // Split on '-->' delimiter, trimming spaces as well\n    time = lines[i++].split(/[\\t ]*-->[\\t ]*/)\n\n    sub.start = toMilliseconds(time[0])\n\n    // So as to trim positioning information from end\n    idx = time[1].indexOf(' ')\n    if (idx !== -1) {\n      time[1] = time[1].substr(0, idx)\n    }\n    sub.end = toMilliseconds(time[1])\n\n    // Build single line of text from multi-line subtitle in file\n    while (i < endIdx && lines[i]) {\n      text.push(lines[i++])\n    }\n\n    // Join into 1 line, SSA-style linebreaks\n    // Strip out other SSA-style tags\n    sub.text = text.join('\\\\N').replace(/\\{(\\\\[\\w]+\\(?([\\w\\d]+,?)+\\)?)+\\}/gi, '')\n\n    // Escape HTML entities\n    sub.text = sub.text.replace(/</g, '&lt;').replace(/>/g, '&gt;')\n\n    // Unescape great than and less than when it makes a valid html tag of a supported style (font, b, u, s, i)\n    // Modified version of regex from Phil Haack's blog: http://haacked.com/archive/2004/10/25/usingregularexpressionstomatchhtml.aspx\n    // Later modified by kev: http://kevin.deldycke.com/2007/03/ultimate-regular-expression-for-html-tag-parsing-with-php/\n    sub.text = sub.text.replace(/&lt;(\\/?(font|b|u|i|s))((\\s+(\\w|\\w[\\w\\-]*\\w)(\\s*=\\s*(?:\".*?\"|'.*?'|[^'\">\\s]+))?)+\\s*|\\s*)(\\/?)&gt;/gi, '<$1$3$7>')\n    sub.text = sub.text.replace(/\\\\N/gi, '<br />')\n\n    subs.push(sub)\n  }\n\n  return subs\n}\n"],"names":["toMilliseconds","time","t","split","s","length","parseFloat","e","nextNonEmptyLine","linesArray","position","idx","lastNonEmptyLine","parseSRT","data","subs","lines","endIdx","text","sub","i","id","parseInt","start","indexOf","substr","end","push","join","replace"],"mappings":";;;;;;AAEA;;;;;;;;;AAwBA,SAASA,cAAT,CAAyBC,IAAzB,EAA+B;MACvBC,IAAID,KAAKE,KAAL,CAAW,GAAX,CAAV;;MAEI;QACEC,IAAIF,EAAE,CAAF,EAAKC,KAAL,CAAW,GAAX,CAAR;;QAGIC,EAAEC,MAAF,KAAa,CAAjB,EAAoB;UACdH,EAAE,CAAF,EAAKC,KAAL,CAAW,GAAX,CAAJ;;;WAGKG,WAAWJ,EAAE,CAAF,CAAX,EAAiB,EAAjB,IAAuB,OAAvB,GAAiCI,WAAWJ,EAAE,CAAF,CAAX,EAAiB,EAAjB,IAAuB,KAAxD,GAAgEI,WAAWF,EAAE,CAAF,CAAX,EAAiB,EAAjB,IAAuB,IAAvF,GAA8FE,WAAWF,EAAE,CAAF,CAAX,EAAiB,EAAjB,CAArG;GARF,CASE,OAAOG,CAAP,EAAU;WACH,CAAP;;;;AAYJ,SAASC,gBAAT,CAA2BC,UAA3B,EAAuCC,QAAvC,EAAiD;MAC3CC,MAAMD,QAAV;;SAEO,CAACD,WAAWE,GAAX,CAAR,EAAyB;;;;SAIlBA,GAAP;;;AAUF,SAASC,gBAAT,CAA2BH,UAA3B,EAAuC;MACjCE,MAAMF,WAAWJ,MAAX,GAAoB,CAA9B;;SAEOM,OAAO,CAAP,IAAY,CAACF,WAAWE,GAAX,CAApB,EAAqC;;;;SAI9BA,GAAP;;;AAuBF,AAAe,SAASE,QAAT,GAA8B;MAAXC,IAAW,uEAAJ,EAAI;;MAErCC,OAAO,EAAb;MACMC,QAAQF,KAAKX,KAAL,CAAW,kBAAX,CAAd;MACIc,SAASL,iBAAiBI,KAAjB,IAA0B,CAAvC;MACIL,MAAM,CAAV;MACIV,aAAJ;MACIiB,aAAJ;MACIC,YAAJ;;OAEK,IAAIC,IAAI,CAAb,EAAgBA,IAAIH,MAApB,EAA4BG,GAA5B,EAAiC;UACzB,EAAN;WACO,EAAP;;QAEIZ,iBAAiBQ,KAAjB,EAAwBI,CAAxB,CAAJ;QACIC,EAAJ,GAASC,SAASN,MAAMI,GAAN,CAAT,EAAqB,EAArB,CAAT;;WAGOJ,MAAMI,GAAN,EAAWjB,KAAX,CAAiB,iBAAjB,CAAP;;QAEIoB,KAAJ,GAAYvB,eAAeC,KAAK,CAAL,CAAf,CAAZ;;UAGMA,KAAK,CAAL,EAAQuB,OAAR,CAAgB,GAAhB,CAAN;QACIb,QAAQ,CAAC,CAAb,EAAgB;WACT,CAAL,IAAUV,KAAK,CAAL,EAAQwB,MAAR,CAAe,CAAf,EAAkBd,GAAlB,CAAV;;QAEEe,GAAJ,GAAU1B,eAAeC,KAAK,CAAL,CAAf,CAAV;;WAGOmB,IAAIH,MAAJ,IAAcD,MAAMI,CAAN,CAArB,EAA+B;WACxBO,IAAL,CAAUX,MAAMI,GAAN,CAAV;;;QAKEF,IAAJ,GAAWA,KAAKU,IAAL,CAAU,KAAV,EAAiBC,OAAjB,CAAyB,oCAAzB,EAA+D,EAA/D,CAAX;;QAGIX,IAAJ,GAAWC,IAAID,IAAJ,CAASW,OAAT,CAAiB,IAAjB,EAAuB,MAAvB,EAA+BA,OAA/B,CAAuC,IAAvC,EAA6C,MAA7C,CAAX;;QAKIX,IAAJ,GAAWC,IAAID,IAAJ,CAASW,OAAT,CAAiB,sGAAjB,EAAyH,UAAzH,CAAX;QACIX,IAAJ,GAAWC,IAAID,IAAJ,CAASW,OAAT,CAAiB,OAAjB,EAA0B,QAA1B,CAAX;;SAEKF,IAAL,CAAUR,GAAV;;;SAGKJ,IAAP;;;;;"}